#!/usr/bin/env bash
set -euo pipefail

# before setting up the dotfiles, lets make sure we setup all the
# dependency.

repositories=()
packages=(
    apt-transport-https
    ca-certificates
    curl
    direnv
    fontconfig
    git
    gnupg-agent
    htop
    jq
    ranger
    software-properties-common
    tar
    tmux
    unzip
    wget
    zsh
)

# unattended upgrades setup
# https://haydenjames.io/how-to-enable-unattended-upgrades-on-ubuntu-debian/
packages+=(
  unattended-upgrades
  apt-listchanges
)

# pyenv dependency
packages+=(
    make
    build-essential
    libssl-dev
    zlib1g-dev
    libbz2-dev
    libreadline-dev
    libsqlite3-dev
    llvm
    libncursesw5-dev
    xz-utils
    tk-dev
    libxml2-dev
    libxmlsec1-dev
    libffi-dev
    liblzma-dev
)

{{ if eq .emacs true }}
# emacs dpendency, went through the INSTALL file from emacs-27 branch
# from github. Also some reference:
# https://emacsredux.com/blog/2021/12/19/using-emacs-on-windows-11-with-wsl2/
packages+=(
    autoconf
    texinfo
    libharfbuzz-dev
    libharfbuzz-info
    libgtk-3-dev
    libgnutls28-dev
    libtiff5-dev
    libgif-dev
    libjpeg-dev
    libpng-dev
    libxpm-dev
    libncurses-dev
)
{{ end }}

# go, neovim lang repository
repositories+=(
	ppa:longsleep/golang-backports
    ppa:neovim-ppa/unstable
)
packages+=(
    golang-go
    neovim
)

for repository in ${repositories[@]}; do
	sudo add-apt-repository -y $repository
done

sudo apt update

# install all the packages
sudo apt install -y ${packages[@]}

echo "install zenith"
ZENITH=https://github.com/bvaisvil/zenith/releases/download/0.12.0/zenith_0.12.0-1_amd64.deb
wget $ZENITH -O /tmp/zenith.deb
sudo apt install /tmp/zenith.deb

echo "purge unwanted packages"
sudo apt purge -y vim fd-find
