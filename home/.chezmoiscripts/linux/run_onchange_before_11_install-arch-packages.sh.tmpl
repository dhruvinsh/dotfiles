#!/usr/bin/env bash
set -euo pipefail

# if arch based system
{{- if lookPath "pacman" }}
packages=()
packages_aur=()
# bootstrapping archlinux
packages=(
    inotify-tools
    sddm
    xorg
    xorg-xinit
)

# hardware bring ups like network, audio, graphics, printers
packages+=(
    acpi
    acpid
    alsa-utils
    blueberry
    blueman
    bluez
    bluez-utils
    cpupower
    jack2
    mesa
    network-manager-applet
    networkmanager # its already installed but lets keep it here
    networkmanager-openvpn
    pipewire
    pipewire-alsa
    pipewire-media-session
    pipewire-pulse
    pipewire-zeroconf
    # pulseaudio
    # pulseaudio-alsa
    # pulseaudio-bluetooth
    # pulsemixer
    udisks2
    upower
    volumeicon
    vulkan-intel
    xf86-input-libinput
    xf86-video-intel # I know I will be using it on laptop
)

# NOTE: xmonad feels alien and hard to learn haskell for now, dropping it for now
# and switching to diffrent WM (keep changing mind)
# xmonad setup
# packages+=(
#     picom
#     rofi  # or dmenu
#     trayer
#     xmobar
#     xmonad
#     xmonad-contrib
# )

# # i3-gaps setup
# packages+=(
#     i3-gaps
#     picom
#     polybar
#     rofi
# )
# packages_aur+=(
#     autotiling
#     flashfocus
#     rofi-greenclip
# )

# qtile setup
packages+=(
    qtile
)

# some visual packages like fonts, themes, icons etc
packages+=(
    adobe-source-code-pro-fonts
    adobe-source-sans-fonts
    arandr
    harfbuzz
    lxappearance
    otf-font-awesome
    papirus-icon-theme
    ttf-joypixels
    ttf-ubuntu-font-family
)

# some usefule packages
packages+=(
    alacritty
    aspell
    aspell-en
    avahi
    cmake
    code
    conky
    cups
    cups-pdf
    curl
    dialog
    direnv
    dunst
    fd
    ffmpegthumbnailer
    firefox
    fontconfig
    fzf
    git
    gnupg
    gutenprint
    hplip
    htop
    iftop
    imagemagick
    jq
    libnotify
    light
    lm_sensors
    lsb-release
    mpc
    mpd
    mpv
    ncmpcpp
    neovim
    nitrogen
    ntfs-3g
    openssh
    pacman-contrib
    pcmanfm-gtk3
    powertop
    ranger
    ranger
    redshift
    ripgrep
    samba
    scrot
    shellcheck
    sqlite
    startup-notification
    stylua
    sxiv
    tar
    tlp
    tmux
    unzip
    wget
    xclip
    zathura
    zathura-pdf-mupdf
    zsh
)

# python build packages
# Arch linux does supports latest python but I will stick to pyenv
packages+=(
    base-devel
    openssl
    tk
    xz
    zlib
)
# aur packages
packages_aur+=(
    poweralertd
    # pulseaudio-ctl
    ttf-ms-fonts
    tlpui
)

{{ if eq .emacs true }}
# for arch linux emacs-nativecomp is available
packages+=(
    emacs-nativecomp
)
{{ end -}}

# install all the packages
sudo pacman -S --noconfirm --needed ${packages[@]}

# some variable
echo "local bin directory setup"
LOCALBIN=$HOME/.local/bin
[ -d "$LOCALBIN" ] && echo "directory exists" || mkdir -p $LOCALBIN

echo "set ZSH to default"
if [ "$SHELL" != "/usr/bin/zsh" ]; then
    sudo chsh -s $(which zsh) $USER
fi


echo "YAY installation"
if [ ! -x "$(command -v yay)" ]; then
    git clone https://aur.archlinux.org/yay-git.git ~/Downloads/yay-git
    cd ~/Downloads/yay-git
    makepkg -si
    cd ~
fi
yay -S --nocleanmenu --nodiffmenu --removemake --norebuild --noredownload ${packages_aur[@]}
{{- end }}
